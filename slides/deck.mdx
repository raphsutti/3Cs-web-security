export { default as theme } from "./src";
import { Head, Image } from "mdx-deck";
import {
  Frontpage,
  Lastpage,
  Layout,
  LayoutNoFooter,
  Split,
  BGImage,
} from "./src";
import { CodeSurfer } from "mdx-deck-code-surfer";
import nightOwl from "prism-react-renderer/themes/nightOwl";

<Head>
  <title>Web security 101: Cookies, CSRF, CORS, and XSS</title>
</Head>

<BGImage src={require("file-loader!./images/sesamestreet2.jpg")} />

<Frontpage>

# Today's letter is C

## Cookies, CSRF, CORS, and XSS

### Web security 101

</Frontpage>

---

export default Layout;

### My name is Raph

---

export default Split;

<img src={require("file-loader!./images/codeclub.jpg")} />

- ~~Mechanical Engineer~~
- ~~GRC Security~~
- Developer @ SEEK
- Really like learning
- Really like teaching

---

export default Layout;

### Cookie

### XSS

### CSRF

### CORS

---

export default Layout;

What is a cookie?

---

export default Layout;

Back in the old days

<img src={require("file-loader!./images/grandpa.gif")} />

```notes
Before we can define cookies, we have to go back to old days
```

---

export default Layout;

Simpler times

- Simple static web pages
- No username/passwords
- No need to keep track of who you are
- No big impact of getting hacked

---

export default Layout;

Now

- Complex web applications
- We need to keep track of logged on users
- Hide all the secrets
- Stop all the unauthorised users

---

export default Layout;

<img src={require("file-loader!./images/oprahcookie.jpg")} />

---

export default Layout;

<img src={require("file-loader!./images/buthow.jpg")} />

---

export default Layout;

<img src={require("file-loader!./images/cookie1.png")} />

---

export default Layout;

<img src={require("file-loader!./images/cookie2.png")} />

---

export default Layout;

<img src={require("file-loader!./images/cookie3.png")} />

---

export default Layout;

<img src={require("file-loader!./images/cookie4.png")} />

```notes
Cookie is given so users dont need to log in every times
Cookie is a key-value pair supplied in the HTTP header
Cookie value format is up to the programmer
```

---

export default Layout;

<img src={require("file-loader!./images/momentslater.jpg")} />

---

export default Layout;

<img src={require("file-loader!./images/cookie5.png")} />

```notes
Browser automatically supplies the cookie
```

---

export default Layout;

<img src={require("file-loader!./images/cookie6.png")} />

---

export default Layout;

<img src={require("file-loader!./images/demogods.png")} />

Attack: Bad cookie value

http://localhost:2021/

---

export default Layout;

<img src={require("file-loader!./images/surprisedpikachu1.jpg")} />

```notes
Dont worry pikachu we have fix
```

---

export default Layout;

<img src={require("file-loader!./images/demogods.png")} />

Defence: Better cookie value

http://localhost:2021/

---

export default Layout;

What is Cross Site Scripting (XSS)?

---

export default Layout;

Web application uses untrusted user input without validation or encoding

- `<` can be encoded to `&lt;`
- Without encoding, browser run `<script>` as scripts
- With encoding, browser _show_ `&lt;script&gt;`

```notes
Type of injection, in which malicious scripts are injected into otherwise benign and trusted websites.
XSS attacks occur when an attacker uses a web application to send malicious code, generally in the form of a browser side script
Flaws occur anywhere a web application uses input from a user within the output it generates without validating or encoding it.
```

---

export default Layout;

<img src={require("file-loader!./images/demogods2.png")} />

Attack: XSS to exfil cookies

http://localhost:2021/

```notes
Get target to open malicious link
Cookie stolen
No need for password. Password complexity out the window
```

---

export default Layout;

<img src={require("file-loader!./images/surprisedpikachu2.jpg")} />

---

export default Layout;

<img src={require("file-loader!./images/lupin.gif")} />

A few defense techniques

---

export default Layout;

<img src={require("file-loader!./images/demogods2.png")} />

Defence: Sanitise user input

http://localhost:2021/

```notes
XSS no longer work
```

---

export default LayoutNoFooter;

<CodeSurfer
  theme={nightOwl}
  language="javascript"
  code={`
router.get("/", (ctx) => {
  const param = ctx.query.v // I trust you, user input ðŸ”¥
  ...
  ctx.body = \`<h3>
    Oh cool, I can repeat your query param: \${param}. Harmless right?</h3>\`
    })
`}
/>

```notes
current code
```

---

export default LayoutNoFooter;

<CodeSurfer
  theme={nightOwl}
  language="javascript"
  code={`
router.get("/", (ctx) => {
  const param = escape(ctx.query.v) // sanitised âœ¨
  ...
  ctx.body = \`<h3>
    Oh cool, I can repeat your query param: \${param}. Harmless right?</h3>\`
    })
`}
/>

```notes
current code
```

---

export default Layout;

<img src={require("file-loader!./images/demogods2.png")} />

Defence: Strong cookies - httpOnly

http://localhost:2021/

```notes
Cookie no longer accessible via javascript
```

---

export default LayoutNoFooter;

<CodeSurfer
  theme={nightOwl}
  language="javascript"
  code={`
ctx.cookies.set("sessionId", nextSessionId);
`}
/>

```notes
current code
```

---

export default LayoutNoFooter;

<CodeSurfer
  theme={nightOwl}
  language="javascript"
  code={`
ctx.cookies.set("sessionId", nextSessionId, {
  httpOnly: true,
});
`}
/>

```notes
httpOnly - cookie accesible via javascript

Great, so which method should we use?
```

---

export default Layout;

<img src={require("file-loader!./images/whynotboth.gif")} />

---

export default Layout;

What is Cross Site Request Forgery (CSRF)?

---

export default Layout;

Causes user to execute unwanted actions where they are currently authenticated.

- Eg. Transferring funds, changing their email address

- If user is admin, CSRF can compromise the entire web

---

export default Layout;

Diagrams

---

export default Split;

- Javascript
- Typescript
- Ruby
- PHP
- Python
- Java
- C/C++

* Perl
* .NET
* Erlang
* Elixir
* Haskell
* Rust
* Lua

---

export default Layout;

<img src={require("file-loader!./images/demogods2.png")} />

Defence: Strong cookies - sameSite

http://localhost:2021/

```notes
Cookie no longer accessible via another domain
```

---

export default LayoutNoFooter;

<CodeSurfer
  theme={nightOwl}
  language="javascript"
  code={`
ctx.cookies.set("sessionId", nextSessionId, {
  httpOnly: true,
});
`}
/>

```notes
httpOnly - cookie accesible via javascript
secure - HTTPS
sameSite - cookie sending depending on sites
```

---

export default LayoutNoFooter;

<Lastpage></Lastpage>

# Thank You
